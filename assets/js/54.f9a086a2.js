(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{442:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("p",[t._v("自己自学"),a("code",[t._v("Appium")]),t._v("测试公司的APP有一段时间的，"),a("code",[t._v("Android")]),t._v("原生的元素定位，包括数据处理和逻辑判断也基本上搞熟了，但是公司的APP很坑爹，开发过程中存在混合开发的情况，这就意味着我必须要处理APP里面的webview，真的是很坑爹的东西。")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("操作系统：Mac OS X EI Caption")]),t._v(" "),a("p",[t._v("Appium: 1.4.16")]),t._v(" "),a("p",[t._v('Java: java version "1.7.0_79"')]),t._v(" "),a("p",[t._v("node.js: v5.3.0")]),t._v(" "),a("p",[t._v("npm: 3.3.12")]),t._v(" "),a("p",[t._v("手机：小米NOTE4")]),t._v(" "),a("p",[t._v("待测应用： 微证券")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"常规方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常规方法"}},[t._v("#")]),t._v(" 常规方法")]),t._v(" "),a("p",[t._v("正常来说，常规的方法应该是使用"),a("code",[t._v("UI Automator Viewer")]),t._v("来探测页面的元素，比如下面这样：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ww1.sinaimg.cn/mw690/811987cbgw1f20rlzwtwwj21kw103thr.jpg",alt:"页面元素"}})]),t._v(" "),a("p",[t._v("但是，如果是混合开发，就会出现只有一个"),a("code",[t._v("webview")]),t._v("元素的情况，正常的方法无法定位。比如这样：\n"),a("img",{attrs:{src:"http://ww3.sinaimg.cn/mw690/811987cbgw1f25r2354hcj21d4120n6k.jpg",alt:"webview"}})]),t._v(" "),a("p",[t._v("常规的方法是没办法定位出这部分内容，只有一个webview，无法像原生一样获取内容。")]),t._v(" "),a("h2",{attrs:{id:"取巧的办法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#取巧的办法"}},[t._v("#")]),t._v(" 取巧的办法")]),t._v(" "),a("p",[t._v("如果针对H5的元素，只需要点击的话，可以这么做，比如上文我们的开户页面，我们需要做的只是在这个页面上点击立即开户，跳转到下一个页面，我们可以用这种取巧的方法：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'立即开户'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("click"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这样的代码，也是可以实现的，当然，上面的get_name我是进行封装了的，原来的代码是：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        element "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_element_by_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" element\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"更优化的处理方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更优化的处理方式"}},[t._v("#")]),t._v(" 更优化的处理方式")]),t._v(" "),a("p",[t._v("既然是H5页面，如果能够获取HTML代码就好了，那么就可以使用操作DOM的方式来操作这个H5。")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("谷歌浏览器：版本 49.0.2623.87 (64-bit)")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("我用的谷歌浏览器是这个版本，把手机连接上电脑，在谷歌浏览器中输入这个代码：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("chrome://inspect\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("点击这个按钮：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ww1.sinaimg.cn/mw690/811987cbgw1f25rku93r2j21kw176grv.jpg",alt:"inspect"}})]),t._v(" "),a("p",[t._v("神奇的一幕出现了，所有的代码都展示在你面前。就像web一样调试混合APP中的H5.")]),t._v(" "),a("h2",{attrs:{id:"切换webdriver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换webdriver"}},[t._v("#")]),t._v(" 切换webdriver")]),t._v(" "),a("p",[t._v("虽然解决了html代码的问题，但是另一个问题出现了，我们要怎么去操作DOM。常规的方法是没办法了，只能操作原生的，这个时候我们需要把webdriver切换成H5的，而不是原生的。")]),t._v(" "),a("p",[t._v("其实原理很简单，只要把"),a("code",[t._v("webdriver")]),t._v("切换到H5的方式就行了。使用如下代码：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("contexts\ncontexts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    Returns the contexts within the current session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    返回当前会话中的上下文，使用后可以识别H5页面的控件\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Usage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contexts\n用法 driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contexts\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("调用这个方法后，把结果打印出来，你会发现是一个列表，列表中的第一个是NATIVE_APP，这个就表示现在的"),a("code",[t._v("webdriver")]),t._v("是调用原生的功能，我们使用这个命令切换一下就行了。")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switch_h5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MobileCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SWITCH_TO_CONTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WEBVIEW_com.weizq"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switch_app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MobileCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SWITCH_TO_CONTEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NATIVE_APP"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("第一个函数就是封装切换到H5的方法，"),a("code",[t._v("name")]),t._v("对应的东西就是通过"),a("code",[t._v("contexts")]),t._v("列表中打印出来的东西，当然你也可以使用其他的方法封装。")]),t._v(" "),a("p",[t._v("切换到H5的"),a("code",[t._v("webdriver")]),t._v("之后，再使用"),a("code",[t._v("driver.find_element_by_id")]),t._v("试试？现在就变成查找DOM相关的功能了，再调用第二个函数，又切回原生的"),a("code",[t._v("webdriver")]),t._v("了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);