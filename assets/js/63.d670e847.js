(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{484:function(t,a,v){"use strict";v.r(a);var _=v(0),s=Object(_.a)({},(function(){var t=this,a=t.$createElement,v=t._self._c||a;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"前言"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),v("p",[t._v("这两周用"),v("code",[t._v("python")]),t._v("自己折腾了一个安卓性能测试工具，当然，整套工具的功能还不够完善，但是，测试几个指标基本上是没什么问题的。本着结果驱动的原则，先用这套工具来试试我们的宇宙级炒股APP"),v("strong",[t._v("微证券")]),t._v("（下称宇宙APP）的性能。")]),t._v(" "),v("h2",{attrs:{id:"工具概览"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#工具概览"}},[t._v("#")]),t._v(" 工具概览")]),t._v(" "),v("p",[t._v("工具的开发流程在这里："),v("a",{attrs:{href:"http://wybblog.applinzi.com/blog/article/39/",target:"_blank",rel:"noopener noreferrer"}},[t._v("《AndroidTestTool开发笔记》"),v("OutboundLink")],1)]),t._v(" "),v("p",[t._v("工具由两部分组成，一是客户端，二是"),v("code",[t._v("web")]),t._v("端，具体怎么划分的？其实我就是看心情。工具大概长这样")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977685497292.jpg",alt:"客户端"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977707575372.jpg",alt:"web端"}})]),t._v(" "),v("h2",{attrs:{id:"工具的作用"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#工具的作用"}},[t._v("#")]),t._v(" 工具的作用")]),t._v(" "),v("p",[t._v("工具大概监控这么几个指标，"),v("code",[t._v("内存")]),t._v("、"),v("code",[t._v("cpu")]),t._v("、"),v("code",[t._v("wlan")]),t._v("流量，以及封装了"),v("code",[t._v("Monkey")]),t._v("做满负载执行。")]),t._v(" "),v("h2",{attrs:{id:"多次测试正常使用的指标"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#多次测试正常使用的指标"}},[t._v("#")]),t._v(" 多次测试正常使用的指标")]),t._v(" "),v("h3",{attrs:{id:"一次测试—模拟正常手工操作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一次测试—模拟正常手工操作"}},[t._v("#")]),t._v(" 一次测试—模拟正常手工操作")]),t._v(" "),v("p",[t._v("首先模拟正常的操作监控内存、"),v("code",[t._v("cpu")]),t._v("和"),v("code",[t._v("wlan")]),t._v("流量（全程使用"),v("code",[t._v("wifi")]),t._v("，所以这个指标代表流量的消耗），测试时间5分钟左右（使用秒表记录，时间可能会有略微的偏差）。")]),t._v(" "),v("h4",{attrs:{id:"第一次内存监控数据："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第一次内存监控数据："}},[t._v("#")]),t._v(" 第一次内存监控数据：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977730082203.jpg",alt:"内存监控"}})]),t._v(" "),v("h4",{attrs:{id:"第一次cpu监控数据："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第一次cpu监控数据："}},[t._v("#")]),t._v(" 第一次cpu监控数据：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977747376223.jpg",alt:"cpu监控"}})]),t._v(" "),v("h4",{attrs:{id:"第一次流量监控："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第一次流量监控："}},[t._v("#")]),t._v(" 第一次流量监控：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379777750394711.jpg",alt:"流量监控"}})]),t._v(" "),v("h4",{attrs:{id:"第一次测试的总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第一次测试的总结"}},[t._v("#")]),t._v(" 第一次测试的总结")]),t._v(" "),v("p",[t._v("第一次测试我模拟了正常用户的使用，查看咨询内容、查看个股详情，查看排行榜数据、查看投资学院、修改了头像昵称等操作。")]),t._v(" "),v("p",[t._v("第一次测试暴露了以下问题：")]),t._v(" "),v("ol",[v("li",[t._v("内存存在抖动现象")]),t._v(" "),v("li",[t._v("cpu走势不稳定")])]),t._v(" "),v("p",[t._v("当然一次测试肯定是不够的，上述两个问题的出现很可能是由于其他因素导致的，比如第一次使用"),v("code",[t._v("APP")]),t._v("，会导致加载大量的数据，导致"),v("code",[t._v("CPU")]),t._v("使用量巨大，内存不稳定等问题，而且第一次使用需要加载大量的数据，流量也会慢慢的往上走，带着这些问题，继续进行第二次测试。")]),t._v(" "),v("h3",{attrs:{id:"二次测试—模拟手工测试"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#二次测试—模拟手工测试"}},[t._v("#")]),t._v(" 二次测试—模拟手工测试")]),t._v(" "),v("p",[t._v("二次测试如同第一次测试一样手工执行，获取的指标如下：")]),t._v(" "),v("h4",{attrs:{id:"第二次内存监控数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第二次内存监控数据"}},[t._v("#")]),t._v(" 第二次内存监控数据")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/153797779531778.jpg",alt:"内存监控数据"}})]),t._v(" "),v("h4",{attrs:{id:"第二次cpu监控数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第二次cpu监控数据"}},[t._v("#")]),t._v(" 第二次cpu监控数据")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977826047005.jpg",alt:"cpu监控数据"}})]),t._v(" "),v("h4",{attrs:{id:"第二次流量监控数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第二次流量监控数据"}},[t._v("#")]),t._v(" 第二次流量监控数据")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977846693108.jpg",alt:"流量监控数据"}})]),t._v(" "),v("h4",{attrs:{id:"第二次测试结果的总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第二次测试结果的总结"}},[t._v("#")]),t._v(" 第二次测试结果的总结")]),t._v(" "),v("p",[t._v("从第二次测试结果来看，与第一次的结果并没有很大的出入，内存轻微抖动依然存在，CPU时高时低的情况也没有消除，流量数据也是老样子，不过综合第一第二次来分析，APP的流量消耗其实并不大，流量攀升都在APP打开的初始阶段，也就是在刷财讯数据的时候，都是加载新的资源，其他时候流量的消耗都是缓慢上升。属于可接受范围。")]),t._v(" "),v("p",[v("strong",[t._v("那么问题来了，是因为APP内部的代码有问题，进行了过多的数据处理、图形的绘制，导致走势图抖动，还是正常处理数据的走势图就是这样呢？为了确认这个问题，我找了其他同类的APP进行竞品测试。")])]),t._v(" "),v("h3",{attrs:{id:"竞品测试"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#竞品测试"}},[t._v("#")]),t._v(" 竞品测试")]),t._v(" "),v("p",[t._v("竞品我选择了腾讯的自选股，作为互联网龙头企业的产品比较有标杆作用，来看看自选股的表现怎么样。")]),t._v(" "),v("p",[t._v("同样的时间，同样的我在操作，我们来看自选股的几个指标的表现。")]),t._v(" "),v("h4",{attrs:{id:"自选股内存监控数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#自选股内存监控数据"}},[t._v("#")]),t._v(" 自选股内存监控数据")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977865648233.jpg",alt:"自选股内存监控"}})]),t._v(" "),v("h4",{attrs:{id:"自选股cpu监控数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#自选股cpu监控数据"}},[t._v("#")]),t._v(" 自选股cpu监控数据")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379778895550468.jpg",alt:"自选股CPU监控数据"}})]),t._v(" "),v("h4",{attrs:{id:"自选股流量监控数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#自选股流量监控数据"}},[t._v("#")]),t._v(" 自选股流量监控数据")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977913366476.jpg",alt:"自选股流量监控数据"}})]),t._v(" "),v("h4",{attrs:{id:"综合自选股测试结果的总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#综合自选股测试结果的总结"}},[t._v("#")]),t._v(" 综合自选股测试结果的总结")]),t._v(" "),v("p",[t._v("从自选股的三个指标来看，内存的轻微抖动属于正常现象，只要不超过最大值引发OOM，也不是全程频繁的抖动，我们都可以认为是合理的。CPU的上下波动属于正常现象，行情方面涉及到大量的数据处理，CPU标高，离开行情页面，CPU走低，这种波动也属于正常现象。从趋势图我们可以看出，自选股的内存抖动情况比我们的宇宙APP更加频繁，cpu的浮动相对较少，二者都可以理解为正常的范畴。")]),t._v(" "),v("p",[t._v("从流量上看，自选股显然要比我们的宇宙APP少很多，但是由于APP安全处理等原因，导致没办法抓通讯数据进行分析，只能从表现层来分析数据，自选股的行情数据是通过手工刷新来更新数据的，而我们的宇宙APP是自动刷新的，也就是说在测试的5分钟内，自选股的行情只有我手工触发刷新时才会产生流量，而我们的宇宙APP属于5分钟内无时无刻都在刷新数据，因此产生的流量较高，当然影响流量的因素还有很多，由于种种原因没办法做很深入的分析，只能做一个粗浅的判断。")]),t._v(" "),v("h3",{attrs:{id:"结果"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[t._v("#")]),t._v(" 结果")]),t._v(" "),v("p",[t._v("有图有真相，有数据有真相，从这三个指标来看，我们的宇宙APP离行业的标杆产品还有一些距离，但是这个距离并不大。")]),t._v(" "),v("p",[t._v("当然。APP的好坏不仅仅是这三个指标衡量的，还有功能，用户体验，流畅度等等许多因素影响，本文仅列出这三个指标是因为我的测试工具目前只能测试这三个指标。")]),t._v(" "),v("p",[t._v("现在，来一组满负载（使用"),v("code",[t._v("Monkey")]),t._v("执行）的指标图：")]),t._v(" "),v("p",[t._v("内存信息：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/153797795550417.jpg",alt:"内存监控"}})]),t._v(" "),v("p",[t._v("cpu信息：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977975575534.jpg",alt:"cpu信息"}})]),t._v(" "),v("p",[t._v("流量信息：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537977995830356.jpg",alt:"流量信息"}})]),t._v(" "),v("p",[t._v("由于我对Monkey命令没有做优化处理，因此单一的结果并不具有参考性（很明显，上面测试最后转到了一个死胡同里一直跑，数据全部都是平缓的走）。这里只是为了说明，我们宇宙APP的性能还可以，Monkey并没有跑挂，啊哈哈哈哈！")]),t._v(" "),v("h2",{attrs:{id:"其他指标"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#其他指标"}},[t._v("#")]),t._v(" 其他指标")]),t._v(" "),v("p",[t._v("除了我自己工具的几个指标以外，还有一些其他指标，比如gfxinfo、GPU过度绘制等，我也做了一下简单的测试。")]),t._v(" "),v("h3",{attrs:{id:"gfxinfo"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#gfxinfo"}},[t._v("#")]),t._v(" gfxinfo")]),t._v(" "),v("p",[t._v("这个指标其实就是"),v("code",[t._v("FPS")]),t._v("，打过游戏的对这个名词应该都不陌生，在APP中就表示动态绘制某个页面的时间，官方的说法是大于"),v("code",[t._v("16MS")]),t._v("就会产生卡顿的感觉。这个指标主要是用来衡量一些动态场景的流畅度，在炒股APP里面，一个股票列表的滑动，另一个是自选个股左右滑动的切换。")]),t._v(" "),v("p",[v("code",[t._v("gfxinfo")]),t._v("有三个参考的指标。"),v("code",[t._v("Draw")]),t._v("、"),v("code",[t._v("Process")]),t._v("和"),v("code",[t._v("Execute")]),t._v("。")]),t._v(" "),v("p",[v("code",[t._v("Draw")]),t._v("表示显示列表的时间开销，记录了所有view对象的绘制时间，这个指标高，要么就是"),v("code",[t._v("view")]),t._v("太多，要么就是执行效率太低。")]),t._v(" "),v("p",[v("code",[t._v("Process")]),t._v("表示显示列表中绘制指令的时间，这个指标过高就表示"),v("code",[t._v("View")]),t._v("的数量过多。")]),t._v(" "),v("p",[v("code",[t._v("Execute")]),t._v("表示一副图像由合成器合成的时间，这个指标过高就表示合成的效率低下。")]),t._v(" "),v("p",[t._v("针对这个指标，我们的宇宙APP基本上是惨不忍睹。请看图：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537978014981719.jpg",alt:"gfxinfo"}})]),t._v(" "),v("p",[t._v("在绿色横线以上都是不合格的。所以在使用的时候快速切换个股，可以很直观的感觉非常非常的卡。图中"),v("code",[t._v("Process")]),t._v("的指标突破天际了，所以可以初步断定"),v("code",[t._v("View")]),t._v("的数量过多")]),t._v(" "),v("p",[t._v("对比对比其他的我们看看结果。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537978034459609.jpg",alt:"自选股"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537978053335317.jpg",alt:"同花顺"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379780714553962.jpg",alt:"东方财富"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537978090078099.jpg",alt:"佣金宝"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379781099029272.jpg",alt:"中山证券"}})]),t._v(" "),v("p",[t._v("看了这么些APP的表现。。。只能说券商系的APP在这点上是一脉相承的烂到渣，而互联网公司的产品用户体验就会好上很多。")]),t._v(" "),v("h3",{attrs:{id:"gpu过度绘制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#gpu过度绘制"}},[t._v("#")]),t._v(" GPU过度绘制")]),t._v(" "),v("blockquote",[v("p",[v("code",[t._v("GPU")]),t._v("过度绘制指的是在屏幕一个像素上绘制多次(超过一次),比如一个TextView后有背景，那么显示文本的像素至少绘了两次，一次是背景，一次是文本。GPU过度绘制或多或少对性能有些影响。")])]),t._v(" "),v("p",[t._v("参考指标：")]),t._v(" "),v("blockquote",[v("p",[t._v("蓝色 1x过度绘制")])]),t._v(" "),v("blockquote",[v("p",[t._v("绿色 2x过度绘制")])]),t._v(" "),v("blockquote",[v("p",[t._v("淡红色 3x过度绘制")])]),t._v(" "),v("blockquote",[v("p",[t._v("红色 超过4x过度绘制")])]),t._v(" "),v("p",[t._v("怎么理解这个指标呢，打开GPU显示，如果是红色一片，就表示绘制过度，如果是蓝色绿色，就表示整个UI的体系设计的还是很好的。")]),t._v(" "),v("p",[t._v("我们来看看宇宙APP的表现。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379781419298182.jpg",alt:"com.weizq"}})]),t._v(" "),v("p",[t._v("可以看出，淡红色一整片附带了一些深红色，也就是说过度绘制是比较严重的。")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379781700482922.jpg",alt:"WeChat"}})]),t._v(" "),v("p",[t._v("上图是微信的表现，可以说是非常棒的，可以说，几乎看不到红色。当然，不同类型的产品可比性是比较低的。就像上文中我们说CPU上下跳动很大的情况一样，同类产品的比较才能看出问题。我找了自选股和同花顺的图来对比。")]),t._v(" "),v("p",[t._v("自选股：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379782738802738.jpg",alt:"自选股"}})]),t._v(" "),v("p",[t._v("同花顺：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537978295889555.jpg",alt:"同花顺"}})]),t._v(" "),v("p",[t._v("可以看出，自选股和同花顺都是非常重度的进行了绘制，也从侧面反映了一个问题，行情页面的展示UI是比较复杂的，难免涉及到重复绘制的问题，而IM类的软件结构相对简单，因此重度绘制不明显。")]),t._v(" "),v("p",[t._v("不过话又说回来，这种绘制消耗最大的是CPU。而现在安卓手机的配置高的吓人，CPU没有个4核都不好意思拿出来卖，更何况旗舰级都已经到八核十六核了，再多绘几层用户也不会有感觉。")]),t._v(" "),v("p",[t._v("但是高"),v("code",[t._v("CPU")]),t._v("会大大增加电量的消耗，为什么玩游戏耗电特别快，就是因为游戏动画需要吃非常高的CPU，手机发热，耗电加快，因此这个指标虽然不影响用户体验，但是在不影响功能的情况下，进行优化，也是对APP一个很大的提升。")]),t._v(" "),v("h2",{attrs:{id:"结语"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[t._v("#")]),t._v(" 结语")]),t._v(" "),v("p",[t._v("文章列的一些指标都是无需"),v("code",[t._v("root")]),t._v("无需代码，从一些侧面就能够发现的性能问题，还有很多指标，比如"),v("code",[t._v("uss")]),t._v("需要"),v("code",[t._v("root")]),t._v("，数据处理和IO等指标更是需要从代码入手去埋点检查，衡量一个APP的好坏也不仅仅是看这些指标，还有很多其他因素，So，学习之路还很长。")])])}),[],!1,null,null,null);a.default=s.exports}}]);