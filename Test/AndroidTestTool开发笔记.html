<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AndroidTestTool开发笔记 | Less is more</title>
    <meta name="description" content="仰无愧于天，俯无愧于地，俯仰之间，无愧此生">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.c83c8e8a.css" as="style"><link rel="preload" href="/assets/js/app.9d685a6c.js" as="script"><link rel="preload" href="/assets/js/3.493be8e6.js" as="script"><link rel="preload" href="/assets/js/1.60dcf3bc.js" as="script"><link rel="preload" href="/assets/js/47.228181d7.js" as="script"><link rel="prefetch" href="/assets/js/10.888e9d74.js"><link rel="prefetch" href="/assets/js/100.33f1738e.js"><link rel="prefetch" href="/assets/js/101.5786df3b.js"><link rel="prefetch" href="/assets/js/102.23cbc3fc.js"><link rel="prefetch" href="/assets/js/103.45ac5db4.js"><link rel="prefetch" href="/assets/js/104.3eaadea6.js"><link rel="prefetch" href="/assets/js/105.0bc30d4b.js"><link rel="prefetch" href="/assets/js/106.709d85d8.js"><link rel="prefetch" href="/assets/js/107.5b64e236.js"><link rel="prefetch" href="/assets/js/108.a3c905f4.js"><link rel="prefetch" href="/assets/js/109.4b19484f.js"><link rel="prefetch" href="/assets/js/11.1812ad16.js"><link rel="prefetch" href="/assets/js/110.c71cdf86.js"><link rel="prefetch" href="/assets/js/111.32717b0d.js"><link rel="prefetch" href="/assets/js/112.24922e63.js"><link rel="prefetch" href="/assets/js/113.c8ecb89e.js"><link rel="prefetch" href="/assets/js/114.c052e158.js"><link rel="prefetch" href="/assets/js/115.abf1ca9e.js"><link rel="prefetch" href="/assets/js/116.5b9e7642.js"><link rel="prefetch" href="/assets/js/117.bf2f7af2.js"><link rel="prefetch" href="/assets/js/118.33682ce5.js"><link rel="prefetch" href="/assets/js/119.4aaf35a8.js"><link rel="prefetch" href="/assets/js/12.baec8187.js"><link rel="prefetch" href="/assets/js/120.f9765651.js"><link rel="prefetch" href="/assets/js/121.e12d7a84.js"><link rel="prefetch" href="/assets/js/122.79fc21a4.js"><link rel="prefetch" href="/assets/js/123.5dafbf5d.js"><link rel="prefetch" href="/assets/js/124.5c27ef67.js"><link rel="prefetch" href="/assets/js/125.e3970fd1.js"><link rel="prefetch" href="/assets/js/126.9c5f6ab3.js"><link rel="prefetch" href="/assets/js/127.e0df6215.js"><link rel="prefetch" href="/assets/js/128.ace6151d.js"><link rel="prefetch" href="/assets/js/129.55a63453.js"><link rel="prefetch" href="/assets/js/13.e7e719cd.js"><link rel="prefetch" href="/assets/js/130.d9588605.js"><link rel="prefetch" href="/assets/js/131.d1ff8bc5.js"><link rel="prefetch" href="/assets/js/132.fe00ad5a.js"><link rel="prefetch" href="/assets/js/133.936cbe0f.js"><link rel="prefetch" href="/assets/js/134.49747880.js"><link rel="prefetch" href="/assets/js/135.ad881859.js"><link rel="prefetch" href="/assets/js/136.2dfdeb2e.js"><link rel="prefetch" href="/assets/js/137.dff7cb64.js"><link rel="prefetch" href="/assets/js/138.a6fdc432.js"><link rel="prefetch" href="/assets/js/139.5d5958ac.js"><link rel="prefetch" href="/assets/js/14.1b2bbb55.js"><link rel="prefetch" href="/assets/js/140.48924153.js"><link rel="prefetch" href="/assets/js/141.fc2bcc3c.js"><link rel="prefetch" href="/assets/js/142.2669bff4.js"><link rel="prefetch" href="/assets/js/143.57ea78d5.js"><link rel="prefetch" href="/assets/js/144.96a3a887.js"><link rel="prefetch" href="/assets/js/145.72805b47.js"><link rel="prefetch" href="/assets/js/146.6e95e428.js"><link rel="prefetch" href="/assets/js/147.490340ad.js"><link rel="prefetch" href="/assets/js/148.1f04e4eb.js"><link rel="prefetch" href="/assets/js/149.a8e52392.js"><link rel="prefetch" href="/assets/js/15.f9f8632b.js"><link rel="prefetch" href="/assets/js/150.7e5ddb3c.js"><link rel="prefetch" href="/assets/js/151.6eb46eac.js"><link rel="prefetch" href="/assets/js/152.ed134091.js"><link rel="prefetch" href="/assets/js/153.5a458f77.js"><link rel="prefetch" href="/assets/js/154.df047f91.js"><link rel="prefetch" href="/assets/js/155.b042ac7e.js"><link rel="prefetch" href="/assets/js/156.dd1d8ba5.js"><link rel="prefetch" href="/assets/js/157.602a4d2b.js"><link rel="prefetch" href="/assets/js/158.53918749.js"><link rel="prefetch" href="/assets/js/159.ae5f9ae0.js"><link rel="prefetch" href="/assets/js/16.c566416e.js"><link rel="prefetch" href="/assets/js/160.2fec26f0.js"><link rel="prefetch" href="/assets/js/161.d15ab4d1.js"><link rel="prefetch" href="/assets/js/162.8802d8f6.js"><link rel="prefetch" href="/assets/js/163.93a517a4.js"><link rel="prefetch" href="/assets/js/164.35cdc8a8.js"><link rel="prefetch" href="/assets/js/165.d44a8e98.js"><link rel="prefetch" href="/assets/js/17.c93ea7b2.js"><link rel="prefetch" href="/assets/js/18.1b53ee9c.js"><link rel="prefetch" href="/assets/js/19.7a924170.js"><link rel="prefetch" href="/assets/js/20.aa916792.js"><link rel="prefetch" href="/assets/js/21.c18b69a7.js"><link rel="prefetch" href="/assets/js/22.d78a3eeb.js"><link rel="prefetch" href="/assets/js/23.72fd161e.js"><link rel="prefetch" href="/assets/js/24.0f26a194.js"><link rel="prefetch" href="/assets/js/25.405c9320.js"><link rel="prefetch" href="/assets/js/26.301f9303.js"><link rel="prefetch" href="/assets/js/27.062efaa2.js"><link rel="prefetch" href="/assets/js/28.d69d5319.js"><link rel="prefetch" href="/assets/js/29.98088aae.js"><link rel="prefetch" href="/assets/js/30.edc4d21b.js"><link rel="prefetch" href="/assets/js/31.01913308.js"><link rel="prefetch" href="/assets/js/32.48c5b54e.js"><link rel="prefetch" href="/assets/js/33.e0ba5583.js"><link rel="prefetch" href="/assets/js/34.7dd11bdd.js"><link rel="prefetch" href="/assets/js/35.3465f228.js"><link rel="prefetch" href="/assets/js/36.775e1df9.js"><link rel="prefetch" href="/assets/js/37.97752e68.js"><link rel="prefetch" href="/assets/js/38.a451aa1f.js"><link rel="prefetch" href="/assets/js/39.10dd56c2.js"><link rel="prefetch" href="/assets/js/4.4c755cd7.js"><link rel="prefetch" href="/assets/js/40.5a5a83dd.js"><link rel="prefetch" href="/assets/js/41.b1489efa.js"><link rel="prefetch" href="/assets/js/42.3318fbe0.js"><link rel="prefetch" href="/assets/js/43.dfd98d59.js"><link rel="prefetch" href="/assets/js/44.b5fb316a.js"><link rel="prefetch" href="/assets/js/45.299eabf2.js"><link rel="prefetch" href="/assets/js/46.5f0741b3.js"><link rel="prefetch" href="/assets/js/48.e6b7b906.js"><link rel="prefetch" href="/assets/js/49.a5716249.js"><link rel="prefetch" href="/assets/js/5.703a7709.js"><link rel="prefetch" href="/assets/js/50.5b1a0701.js"><link rel="prefetch" href="/assets/js/51.e0aa569a.js"><link rel="prefetch" href="/assets/js/52.618e89ac.js"><link rel="prefetch" href="/assets/js/53.210df08d.js"><link rel="prefetch" href="/assets/js/54.f9a086a2.js"><link rel="prefetch" href="/assets/js/55.5b5625d1.js"><link rel="prefetch" href="/assets/js/56.2c4825cb.js"><link rel="prefetch" href="/assets/js/57.eed92005.js"><link rel="prefetch" href="/assets/js/58.f1909cb4.js"><link rel="prefetch" href="/assets/js/59.3ec05dcd.js"><link rel="prefetch" href="/assets/js/6.60bdbd75.js"><link rel="prefetch" href="/assets/js/60.983f8cb1.js"><link rel="prefetch" href="/assets/js/61.1e756342.js"><link rel="prefetch" href="/assets/js/62.3d989059.js"><link rel="prefetch" href="/assets/js/63.48b8557d.js"><link rel="prefetch" href="/assets/js/64.9d2c2891.js"><link rel="prefetch" href="/assets/js/65.f9906f67.js"><link rel="prefetch" href="/assets/js/66.bb859945.js"><link rel="prefetch" href="/assets/js/67.a4f7de38.js"><link rel="prefetch" href="/assets/js/68.025886e5.js"><link rel="prefetch" href="/assets/js/69.0cf4bca6.js"><link rel="prefetch" href="/assets/js/7.38af41ed.js"><link rel="prefetch" href="/assets/js/70.6cbd3935.js"><link rel="prefetch" href="/assets/js/71.8ac4c202.js"><link rel="prefetch" href="/assets/js/72.9782063d.js"><link rel="prefetch" href="/assets/js/73.a8127185.js"><link rel="prefetch" href="/assets/js/74.3c8a5bfb.js"><link rel="prefetch" href="/assets/js/75.c3d1069a.js"><link rel="prefetch" href="/assets/js/76.5bb14f57.js"><link rel="prefetch" href="/assets/js/77.ce2a86f8.js"><link rel="prefetch" href="/assets/js/78.05686f59.js"><link rel="prefetch" href="/assets/js/79.1a88a6b5.js"><link rel="prefetch" href="/assets/js/8.1f4f81ea.js"><link rel="prefetch" href="/assets/js/80.0d3cfa3f.js"><link rel="prefetch" href="/assets/js/81.55bc0c8b.js"><link rel="prefetch" href="/assets/js/82.f39e170e.js"><link rel="prefetch" href="/assets/js/83.67ec6517.js"><link rel="prefetch" href="/assets/js/84.5b1d14c2.js"><link rel="prefetch" href="/assets/js/85.375653f4.js"><link rel="prefetch" href="/assets/js/86.4e43fa42.js"><link rel="prefetch" href="/assets/js/87.a230fe53.js"><link rel="prefetch" href="/assets/js/88.65e445b2.js"><link rel="prefetch" href="/assets/js/89.5143161c.js"><link rel="prefetch" href="/assets/js/9.85ebd66c.js"><link rel="prefetch" href="/assets/js/90.300e4569.js"><link rel="prefetch" href="/assets/js/91.10869ab1.js"><link rel="prefetch" href="/assets/js/92.7d96508c.js"><link rel="prefetch" href="/assets/js/93.2f31e1c0.js"><link rel="prefetch" href="/assets/js/94.4f284886.js"><link rel="prefetch" href="/assets/js/95.331bbbb4.js"><link rel="prefetch" href="/assets/js/96.46779fb4.js"><link rel="prefetch" href="/assets/js/97.67572c91.js"><link rel="prefetch" href="/assets/js/98.de3c5857.js"><link rel="prefetch" href="/assets/js/99.4d0523ae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c83c8e8a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-0cb1c278><div data-v-0cb1c278><div id="loader-wrapper" class="loading-wrapper" data-v-4b73742e data-v-0cb1c278 data-v-0cb1c278><div class="loader-main" data-v-4b73742e><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-da0660ba data-v-0cb1c278 data-v-0cb1c278><h3 class="title" style="display:none;" data-v-da0660ba data-v-da0660ba>Less is more</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-da0660ba data-v-da0660ba><input type="password" value="" data-v-da0660ba> <span data-v-da0660ba>Konck! Knock!</span> <button data-v-da0660ba>OK</button></label> <div class="footer" style="display:none;" data-v-da0660ba data-v-da0660ba><span data-v-da0660ba><i class="iconfont reco-theme" data-v-da0660ba></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-da0660ba>vuePress-theme-reco</a></span> <span data-v-da0660ba><i class="iconfont reco-copyright" data-v-da0660ba></i> <a data-v-da0660ba><span data-v-da0660ba>sven_weng</span>
            
          <span data-v-da0660ba>2015 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-0cb1c278><header class="navbar" data-v-0cb1c278><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.png" alt="Less is more" class="logo"> <span class="site-name">Less is more</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/个人杂谈/" class="nav-link"><i class="iconfont undefined"></i>
  个人杂谈
</a></li><li class="dropdown-item"><!----> <a href="/categories/Test/" class="nav-link"><i class="iconfont undefined"></i>
  Test
</a></li><li class="dropdown-item"><!----> <a href="/categories/代码片段/" class="nav-link"><i class="iconfont undefined"></i>
  代码片段
</a></li><li class="dropdown-item"><!----> <a href="/categories/测试/" class="nav-link"><i class="iconfont undefined"></i>
  测试
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/Git/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="iconfont undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/iOS/" class="nav-link"><i class="iconfont undefined"></i>
  iOS
</a></li><li class="dropdown-item"><!----> <a href="/categories/Go/" class="nav-link"><i class="iconfont undefined"></i>
  Go
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/leetcode/" class="nav-link"><i class="iconfont undefined"></i>
  leetcode
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/C++/" class="nav-link"><i class="iconfont undefined"></i>
  C++
</a></li><li class="dropdown-item"><!----> <a href="/categories/RobotFramework/" class="nav-link"><i class="iconfont undefined"></i>
  RobotFramework
</a></li><li class="dropdown-item"><!----> <a href="/categories/翻译/" class="nav-link"><i class="iconfont undefined"></i>
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/categories/大前端/" class="nav-link"><i class="iconfont undefined"></i>
  大前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/diandianhanbin" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/82eee120776d" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/wyb199026" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0cb1c278></div> <aside class="sidebar" data-v-0cb1c278><div class="personal-info-wrapper" data-v-4a3def3c><img src="/head.png" alt="author-avatar" class="personal-img" data-v-4a3def3c> <h3 class="name" data-v-4a3def3c>
    sven_weng
  </h3> <div class="num" data-v-4a3def3c><div data-v-4a3def3c><h3 data-v-4a3def3c>159</h3> <h6 data-v-4a3def3c>文章</h6></div> <div data-v-4a3def3c><h3 data-v-4a3def3c>41</h3> <h6 data-v-4a3def3c>标签</h6></div></div> <hr data-v-4a3def3c></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/个人杂谈/" class="nav-link"><i class="iconfont undefined"></i>
  个人杂谈
</a></li><li class="dropdown-item"><!----> <a href="/categories/Test/" class="nav-link"><i class="iconfont undefined"></i>
  Test
</a></li><li class="dropdown-item"><!----> <a href="/categories/代码片段/" class="nav-link"><i class="iconfont undefined"></i>
  代码片段
</a></li><li class="dropdown-item"><!----> <a href="/categories/测试/" class="nav-link"><i class="iconfont undefined"></i>
  测试
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/Git/" class="nav-link"><i class="iconfont undefined"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="iconfont undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/iOS/" class="nav-link"><i class="iconfont undefined"></i>
  iOS
</a></li><li class="dropdown-item"><!----> <a href="/categories/Go/" class="nav-link"><i class="iconfont undefined"></i>
  Go
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/leetcode/" class="nav-link"><i class="iconfont undefined"></i>
  leetcode
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/C++/" class="nav-link"><i class="iconfont undefined"></i>
  C++
</a></li><li class="dropdown-item"><!----> <a href="/categories/RobotFramework/" class="nav-link"><i class="iconfont undefined"></i>
  RobotFramework
</a></li><li class="dropdown-item"><!----> <a href="/categories/翻译/" class="nav-link"><i class="iconfont undefined"></i>
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/categories/大前端/" class="nav-link"><i class="iconfont undefined"></i>
  大前端
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/diandianhanbin" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/82eee120776d" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/wyb199026" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>AndroidTestTool开发笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#程序的架构" class="sidebar-link">程序的架构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#前端" class="sidebar-link">前端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#tkinter" class="sidebar-link">Tkinter</a></li><li class="sidebar-sub-header"><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#多进程的处理" class="sidebar-link">多进程的处理</a></li><li class="sidebar-sub-header"><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#gui端的一些核心代码" class="sidebar-link">GUI端的一些核心代码</a></li><li class="sidebar-sub-header"><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#web端" class="sidebar-link">Web端</a></li><li class="sidebar-sub-header"><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#内存cpu监控" class="sidebar-link">内存cpu监控</a></li><li class="sidebar-sub-header"><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#流量监控" class="sidebar-link">流量监控</a></li></ul></li><li><a href="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html#结语" class="sidebar-link">结语</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-da0660ba data-v-0cb1c278><h3 class="title" style="display:none;" data-v-da0660ba data-v-da0660ba>AndroidTestTool开发笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-da0660ba data-v-da0660ba><input type="password" value="" data-v-da0660ba> <span data-v-da0660ba>Konck! Knock!</span> <button data-v-da0660ba>OK</button></label> <div class="footer" style="display:none;" data-v-da0660ba data-v-da0660ba><span data-v-da0660ba><i class="iconfont reco-theme" data-v-da0660ba></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-da0660ba>vuePress-theme-reco</a></span> <span data-v-da0660ba><i class="iconfont reco-copyright" data-v-da0660ba></i> <a data-v-da0660ba><span data-v-da0660ba>sven_weng</span>
            
          <span data-v-da0660ba>2015 - </span>
          2020
        </a></span></div></div> <div data-v-0cb1c278><main class="page"><!----> <div class="page-title" style="display:none;"><h1>AndroidTestTool开发笔记</h1> <hr> <div data-v-73367bb4><i class="iconfont reco-account" data-v-73367bb4><span data-v-73367bb4>sven_weng</span></i> <i class="iconfont reco-date" data-v-73367bb4><span data-v-73367bb4>2016-04-19 10:30:53</span></i> <i class="iconfont reco-eye" data-v-73367bb4><span id="/Test/AndroidTestTool%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-73367bb4><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-73367bb4><span class="tag-item" data-v-73367bb4>
      Android
    </span><span class="tag-item" data-v-73367bb4>
      测试
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>这段时间在<code>Testerhome</code>上看了一些有关性能测试的帖子，看别人的东西，始终是别人的，只有自己写一遍才能体会其中的细节，虽然说不要重复造轮子，但是这种基础的东西，造一次轮子能够学会很多东西，最近看的东西也比较多，拿来实战一下也未尝不可。</p> <p>整个工程下来难度其实不大，主要是一些基本知识，只不过涉及的面比较广，需要的要素如下：</p> <hr> <p>开发相关</p> <p>操作系统： Mac OS X EI capitan</p> <p>Python： 2.7</p> <p>Django：1.8.2</p> <p>前端：Html、Css、Js、Bootstrap、jQuery、Ajax、<a href="http://echarts.baidu.com" target="_blank" rel="noopener noreferrer">Echarts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Android：ADB相关知识、Monkey相关知识</p> <hr> <h2 id="程序的架构"><a href="#程序的架构" class="header-anchor">#</a> 程序的架构</h2> <p>当然，用架构来形容有点夸张了，大概的模型如下图：</p> <p><img src="https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/1537978347982095.jpg" alt="程序模型"></p> <p>整个程序的模型并不复杂，都是通过<code>ADB SHELL</code>来操作<code>Android</code>设备、获取设备信息。在最初设计的时候是没有<code>Tkinter</code>的，因为我对这个<code>GUI</code>端并不熟，信号槽的信号传递和事件的绑定并不了解，而Web端相对了解一些。但是执行的时候发现有一些问题。在<a href="http://wybblog.applinzi.com/blog/article/36/" target="_blank" rel="noopener noreferrer">《Python开发测试工具(一)—Monkey》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>里面有详细描述这个问题。于是临时去学习Tkinter的知识，临时硬拼拼了一个GUI端出来。</p> <h2 id="前端"><a href="#前端" class="header-anchor">#</a> 前端</h2> <p>前端分为GUI和Web两个端，GUi端使用Tkinter，Web端使用Bootstrap和jQuery。两个端界面大概长这样。</p> <p><img src="https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379783660962439.jpg" alt="客户端"></p> <p><img src="https://blog-img-1251534856.cos.ap-guangzhou.myqcloud.com/15379783867268102.jpg" alt="web端"></p> <h3 id="tkinter"><a href="#tkinter" class="header-anchor">#</a> Tkinter</h3> <p>最初我的选择不是<code>TKinter</code>，这个<code>Python</code>自带的原生包功能非常原始，而且最关键的是用的人太少，没人写中文文档，我如果要使用它，就必须去看英文的原文。但是其他几个GUI端也都有相应的缺点，<code>PyQt</code>环境搭建麻烦，而且中文文档大多是Qt4的，<code>WxPython</code>文档少，功能也不见得比<code>Tkinter</code>强大多少。最终还是硬着头皮吧T<code>kinter</code>的官方文档看完了，因为没有现成的代码，所以我就把所有代码丢到了一起，全部放在gui.py中，整个代码完全没有结构而言，不过再怎样，功能也算是实现了。</p> <p><strong>Tkinter有几个坑爹的点我简单的列一下。</strong></p> <h4 id="entry只读时无法显示文字"><a href="#entry只读时无法显示文字" class="header-anchor">#</a> Entry只读时无法显示文字</h4> <p>Entry就是一个Text输入框，单行的那种。一旦设置为只读属性，就无法显示文字，所以整个Tkinter如果要做成一个不允许输入又要展示状态的信息媒介，That's Impossible。</p> <h4 id="label不能动态的改变"><a href="#label不能动态的改变" class="header-anchor">#</a> Label不能动态的改变</h4> <p>Tkinter的标签在初始化生成之后，就再也无法改变了，无法做动态的更新。</p> <h4 id="placeholder效果实现起来很坑爹"><a href="#placeholder效果实现起来很坑爹" class="header-anchor">#</a> Placeholder效果实现起来很坑爹</h4> <p>Html中placeholder的效果很友好（就是文本框为空时显示一个提示语，输入内容后提示语消失的属性），但是在Tkinter中如果要实现它，就必须自己动手写两个事件，一是初始化的时候默认赋值，二是点击Entry获得焦点后做一个删除处理。</p> <h4 id="按钮回调函数的时候无法传参"><a href="#按钮回调函数的时候无法传参" class="header-anchor">#</a> 按钮回调函数的时候无法传参</h4> <p>这才是最坑爹的一点。。。基本上函数都要传参的诶~~~当然，通过万能的Google我还是找到了解决办法，就是使用lambda语句来处理。代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
get_cpu_info <span class="token operator">=</span> Button<span class="token punctuation">(</span>master<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">&quot;开始生成cpu信息&quot;</span><span class="token punctuation">,</span>
                              command<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>get_cpuinfo<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span>cpu_monitor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在这么多的坑中，我竟然还是坚持用完了Tkinter，当然我看的是英文的文档，也有可能有这个方法我没有看到，毕竟看英文的文档还是很操蛋的一件事。</p> <h3 id="多进程的处理"><a href="#多进程的处理" class="header-anchor">#</a> 多进程的处理</h3> <p><code>Tkinter</code>是一个单线程的处理机制，我想在执行<code>Monkey</code>的同时又执行获取内存、获取<code>CPU</code>，那就必须挂上多进程来处理（多线程理论上也是可以的，但是实践中我发现经常会发生线程阻塞的情况）。当然，程序比较简单，不需要专门去做进程池来处理，只要每个功能开一个进程去处理就好了。代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
t <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>get_cpuinfo<span class="token punctuation">(</span>package_name<span class="token punctuation">,</span> <span class="token string">'cpuinfo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="gui端的一些核心代码"><a href="#gui端的一些核心代码" class="header-anchor">#</a> GUI端的一些核心代码</h3> <ul><li>执行Monkey</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">run_monkey</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>mk<span class="token punctuation">.</span>merge_command<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span>log_path<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                         <span class="token operator">*</span>self<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token operator">*</span>ENTRYLIST<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">merge_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        组合命令,Monkey使用
        :param path:日志地址
        :param args:Monkey命令中的其他参数
        :return:None
        &quot;&quot;&quot;</span>
        member <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
        command <span class="token operator">=</span> <span class="token string">'adb shell monkey {} &gt; {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>member<span class="token punctuation">,</span> path<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>run<span class="token punctuation">(</span>command<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">collect</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        收集参数中的元素,转换为列表返回
        :param args:传入的参数
        :return:list
        &quot;&quot;&quot;</span>
        str_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> args<span class="token punctuation">:</span>
            str_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> str_list

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li>获取内存信息</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">run_meminfo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> package_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'monkey_check'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">,</span> <span class="token string">'True'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        status <span class="token operator">=</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'monkey_check'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>get_dir<span class="token punctuation">(</span><span class="token string">'meminfo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">while</span> status <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ad<span class="token punctuation">.</span>get_meminfo<span class="token punctuation">(</span>package_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'monkey_check'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'False'</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>

<span class="token keyword">def</span> <span class="token function">get_meminfo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> package_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">&quot;&quot;&quot;
		获取内存信息
		:return:str, 内存信息
		&quot;&quot;&quot;</span>
		newlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		f <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell dumpsys meminfo '</span> <span class="token operator">+</span> package_name<span class="token punctuation">)</span>
		<span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			newlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			mem_total <span class="token operator">=</span> newlist<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span>
			mem_used <span class="token operator">=</span> newlist<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>
			mem_free <span class="token operator">=</span> newlist<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>
		<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
			mem_total <span class="token operator">=</span> <span class="token string">''</span>
			mem_used <span class="token operator">=</span> <span class="token string">''</span>
			mem_free <span class="token operator">=</span> <span class="token string">''</span>
		meminfo <span class="token operator">=</span> <span class="token string">'{},{},{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mem_total<span class="token punctuation">,</span> mem_used<span class="token punctuation">,</span> mem_free<span class="token punctuation">)</span>

		<span class="token keyword">return</span> meminfo


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><ul><li>获取CPU信息</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">get_cpuinfo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> package_name<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">&quot;&quot;&quot;
		往cpuinfo文件夹中新写一个记录cpu信息的文件
		:param package_name:测试包名
		:param url:cpu文件的路径
		:return:None
		&quot;&quot;&quot;</span>
		self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'cpu_check'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">,</span> <span class="token string">'True'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_dir<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
				a <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell dumpsys cpuinfo | grep '</span> <span class="token operator">+</span> package_name<span class="token punctuation">)</span>
				cpuinfo_list <span class="token operator">=</span> a<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cpuinfo_list<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">13</span><span class="token punctuation">:</span>
					cpu <span class="token operator">=</span> <span class="token punctuation">[</span>cpuinfo_list<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cpuinfo_list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cpuinfo_list<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
					cpuinfo <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>cpu<span class="token punctuation">)</span>
					f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>cpuinfo<span class="token punctuation">)</span>
					f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
					time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
					self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
					<span class="token keyword">if</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cpu_check'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;False&quot;</span><span class="token punctuation">:</span>
						<span class="token keyword">break</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>当时写代码的时候比较随性，没有做统一的规划，写完后又不太想重新改，就这样放着吧。</p> <h3 id="web端"><a href="#web端" class="header-anchor">#</a> Web端</h3> <p><code>Web</code>端的处理就相对比较顺畅了，我把收集内存信息和CPU信息都放在Tkinter了，因此在Web端只负责展示就行了。当然，最后我又突发奇想把收集流量信息放在Web端了，主要是流量信息不完全用走势图可以完全展示，因此就把这个功能放在Web端了。</p> <h4 id="web端的几个页面"><a href="#web端的几个页面" class="header-anchor">#</a> web端的几个页面</h4> <p>最初web端我是设计用来查看走势图的，因此有这么几个页面：主页、内存信息、CPU信息、流量信息，本来还有一个gxfinfo，但是不同Android手机展示出来的矩阵不同，统一处理的方案我还没想出来，暂时就搁浅了，等后续想出来后我再补充，在导航栏上我把打开GUI端的按钮集成了进来，也就是说以后我要使用就只要打开WEB端就行了，一站式解决方案。</p> <h4 id="首页"><a href="#首页" class="header-anchor">#</a> 首页</h4> <p>首页原来我是放置一些说明的，后来发现在首页也可以加一些功能，比如直接查看包名、查看<code>Activity</code>，查看手机上有多少app等简单实用的功能。这些功能自己从shell中去获取也不难，但是集成进来之后显得更简单易用了。</p> <h5 id="获取当前包名和activity"><a href="#获取当前包名和activity" class="header-anchor">#</a> 获取当前包名和Activity</h5> <p>获取的命令很简单，在*nux下的命令就是</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
adb shell dumpsys window windows | grep mFocusedApp

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>windows需要调整一下这个命令。获取之后做一些截取就可以拿到包名和Activity，把信息返回给前端即可，代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">get_cur_pknm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			f <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell dumpsys window windows | grep mFocusedApp'</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				pknm <span class="token operator">=</span> x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
			pk_info <span class="token operator">=</span> pknm<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
			pk_data <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token string">'errmsg'</span><span class="token punctuation">:</span> <span class="token string">'查询成功'</span><span class="token punctuation">,</span>
				<span class="token string">'package_name'</span><span class="token punctuation">:</span> pk_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string">'avtivity_name'</span><span class="token punctuation">:</span> pk_info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
			pk_data <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token string">'errmsg'</span><span class="token punctuation">:</span> <span class="token string">'请确认设备正确连接或者是否有打开APP?'</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">return</span> pk_data

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>前端接受代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">//获取当前包名和Activity</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#get_cur_packagename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>
            <span class="token string">'/datashow/get_cur_packagename/'</span><span class="token punctuation">,</span>
            <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#pkinfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token string">'slow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#package_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'当前打开的包名为: &lt;mark&gt;'</span><span class="token operator">+</span>data<span class="token punctuation">[</span><span class="token string">'package_name'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;&lt;/mark&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#activity_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'当前打开的avtivity为: &lt;mark&gt;'</span><span class="token operator">+</span>data<span class="token punctuation">[</span><span class="token string">'avtivity_name'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;&lt;/mark&gt;&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>获取所有第三方应用的命令是这个：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
adb shell pm list package -3

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>依照上面的方式给代码就行了。效果就是这样：</p> <p><img src="http://7xsgl3.com1.z0.glb.clouddn.com/D40ABEF3-5AFF-4107-8DE9-1219E92A724E.png" alt="web端"></p> <h3 id="内存cpu监控"><a href="#内存cpu监控" class="header-anchor">#</a> 内存cpu监控</h3> <p>这两部分的内容类似，都是作为一个展示的页面来处理，就需要后端给数据，数据收集在GUi端做处理，那么前端就需要发Ajax请求到后端获取数据，获取数据后调用Echarts进行绘图。前端的代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">//内存信息获取</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#mem_query'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> filename <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#selquery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> myChart <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/datashow/getmemdata/'</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            myChart<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            myChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    text<span class="token punctuation">:</span> <span class="token string">'内存监控信息'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                tooltip<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    trigger<span class="token punctuation">:</span> <span class="token string">'axis'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                legend<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'内存总体使用量'</span><span class="token punctuation">,</span> <span class="token string">'内存剩余可用量'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                toolbox<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    feature<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                        saveAsImage<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                grid<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    left<span class="token punctuation">:</span> <span class="token string">'3%'</span><span class="token punctuation">,</span>
                    right<span class="token punctuation">:</span> <span class="token string">'4%'</span><span class="token punctuation">,</span>
                    bottom<span class="token punctuation">:</span> <span class="token string">'3%'</span><span class="token punctuation">,</span>
                    containLabel<span class="token punctuation">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                xAxis<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        type<span class="token punctuation">:</span> <span class="token string">'category'</span><span class="token punctuation">,</span>
                        boundaryGap<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                yAxis<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        type<span class="token punctuation">:</span> <span class="token string">'value'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                series<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        name<span class="token punctuation">:</span> <span class="token string">'内存剩余可用量'</span><span class="token punctuation">,</span>
                        type<span class="token punctuation">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
                        areaStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span>normal<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                        data<span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'user_data'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        name<span class="token punctuation">:</span> <span class="token string">'内存总体使用量'</span><span class="token punctuation">,</span>
                        type<span class="token punctuation">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
                        label<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            normal<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                                show<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                position<span class="token punctuation">:</span> <span class="token string">'top'</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        opacity<span class="token punctuation">:</span> <span class="token string">'0.1'</span><span class="token punctuation">,</span>
                        areaStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span>normal<span class="token punctuation">:</span> <span class="token punctuation">{</span>opacity<span class="token punctuation">:</span> <span class="token string">'0.1'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                        data<span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'total_data'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>后端数据我们收集的时候是存在一个一个的TXT文本中，因此需要做这么几件事。</p> <ol><li>在初始化页面的时候，获取所有的txt文件名，在前端生成一个下拉框给用户选择。</li> <li>选择对应的文件查看后，发送数据给前端绘图。</li></ol> <p>因此我是这样设计的，在前端页面初始化的时候，发Ajax请求获取文件名来生成下拉框，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token punctuation">:</span> <span class="token string">'/datashow/getdirlist/meminfo'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> arr <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> select <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;select id='selquery' class='form-control'&gt;&lt;/select&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    select <span class="token operator">=</span> select<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;option value='&quot;</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;'&gt;&quot;</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#selection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>select<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>后端获取所有文件名后返回给前端，这里我会把第一个文件剔除出返回的列表，第一个文件名是我初始化项目结构的时候给的文件，并没有实际的数据，之后按倒叙返回给前端。代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">getDirList</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> cate<span class="token punctuation">)</span><span class="token punctuation">:</span>
	rst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	url <span class="token operator">=</span> <span class="token string">'{}/device_info/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cate<span class="token punctuation">)</span>
	old_rst <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	old_rst<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> x <span class="token keyword">in</span> old_rst<span class="token punctuation">:</span>
		rst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	rst_data <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
		<span class="token string">'data'</span><span class="token punctuation">:</span> rst<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>rst_data<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>CPU信息也是同理获取，代码就不多贴了。</p> <h3 id="流量监控"><a href="#流量监控" class="header-anchor">#</a> 流量监控</h3> <p>流量监控的命令是由两部分组成，一个要取到应用的PID，然后通过这个PID去取相应的记录文件，两部分的代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">get_pid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> package_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">&quot;&quot;&quot;
		获取pid
		:param package_name:包名
		:return: str, pid
		&quot;&quot;&quot;</span>
		pid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		f <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell ps | grep '</span> <span class="token operator">+</span> package_name<span class="token punctuation">)</span>
		<span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			pid_list <span class="token operator">=</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> y <span class="token keyword">in</span> pid_list<span class="token punctuation">:</span>
				<span class="token keyword">if</span> y<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> package_name<span class="token punctuation">:</span>
					<span class="token keyword">for</span> z <span class="token keyword">in</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
						<span class="token keyword">if</span> z<span class="token punctuation">:</span>
							pid<span class="token punctuation">.</span>append<span class="token punctuation">(</span>z<span class="token punctuation">)</span>
		rst <span class="token operator">=</span> pid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token keyword">return</span> rst
		
<span class="token keyword">def</span> <span class="token function">write_flow</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> package_name<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">,</span> <span class="token string">'True'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_dir<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fn<span class="token punctuation">:</span>
			<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
				rst_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
				f <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell cat /proc/{}/net/dev | grep wlan0'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_pid<span class="token punctuation">(</span>package_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">for</span> y <span class="token keyword">in</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
						<span class="token keyword">if</span> y<span class="token punctuation">:</span>
							rst_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
				up <span class="token operator">=</span> rst_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>
				down <span class="token operator">=</span> rst_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
				flowInfo <span class="token operator">=</span> <span class="token string">'{},{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>down<span class="token punctuation">,</span> up<span class="token punctuation">)</span>
				fn<span class="token punctuation">.</span>write<span class="token punctuation">(</span>flowInfo<span class="token punctuation">)</span>
				fn<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
				<span class="token keyword">print</span> flowInfo
				time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
				self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'mark'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;False&quot;</span><span class="token punctuation">:</span>
					<span class="token keyword">break</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>流量的功能需要记录执行的时间和上行下行流量，因此在开始记录流量的时候，我会在配置文件写入一个时间戳，和已发生的上下行流量，停止的时候再记录一次信息，两个信息对减的结果返回给前端，前端就能展示时间和消耗的流量了。代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">get_flow</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> package_name<span class="token punctuation">,</span> mark<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">&quot;&quot;&quot;
		获取流量信息
		:param package_name:包名
		:param mark:获取流量的标记
		:return:
		&quot;&quot;&quot;</span>
		<span class="token keyword">if</span> mark <span class="token operator">==</span> <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span>
			rst_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			f <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell cat /proc/{}/net/dev | grep wlan0'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_pid<span class="token punctuation">(</span>package_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">for</span> y <span class="token keyword">in</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">if</span> y<span class="token punctuation">:</span>
						rst_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
			rst <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			conf_data <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'flowup'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'flowdown'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'timestart'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'flow_total'</span><span class="token punctuation">,</span> conf_data<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'flow_up'</span><span class="token punctuation">,</span> conf_data<span class="token punctuation">[</span><span class="token string">'flowup'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'flow_down'</span><span class="token punctuation">,</span> conf_data<span class="token punctuation">[</span><span class="token string">'flowdown'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'time_start'</span><span class="token punctuation">,</span> conf_data<span class="token punctuation">[</span><span class="token string">'timestart'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			rst_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			f <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'adb shell cat /proc/{}/net/dev | grep wlan0'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_pid<span class="token punctuation">(</span>package_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">for</span> y <span class="token keyword">in</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">if</span> y<span class="token punctuation">:</span>
						rst_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
			rst <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			end_data <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'flowup'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'flowdown'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rst_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'timend'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'monkey.conf'</span><span class="token punctuation">)</span>
			oldTotal <span class="token operator">=</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'flow_total'</span><span class="token punctuation">)</span>
			oldUp <span class="token operator">=</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'flow_up'</span><span class="token punctuation">)</span>
			oldDown <span class="token operator">=</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'flow_down'</span><span class="token punctuation">)</span>
			oldTime <span class="token operator">=</span> self<span class="token punctuation">.</span>cf<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'flow_mark'</span><span class="token punctuation">,</span> <span class="token string">'time_start'</span><span class="token punctuation">)</span>
			rst_data <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>end_data<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>oldTotal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'up'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>end_data<span class="token punctuation">[</span><span class="token string">'flowup'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>oldUp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'down'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>end_data<span class="token punctuation">[</span><span class="token string">'flowdown'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>oldDown<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>end_data<span class="token punctuation">[</span><span class="token string">'timend'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">float</span><span class="token punctuation">(</span>oldTime<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> rst_data

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>因为处理的东西比较多，所以我也贴一下前端的代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#getflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#getflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> myDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> package_name <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token string">'点击开始测试'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#getflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn btn-danger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
                <span class="token string">'/datashow/testflow/'</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>mark<span class="token punctuation">:</span> <span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token keyword">package</span><span class="token punctuation">:</span> package_name<span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#getflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'点击停止测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'开始测试时间为: '</span> <span class="token operator">+</span> myDate<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#getflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn btn-default'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'结束测试时间为: '</span> <span class="token operator">+</span> myDate<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#getflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'点击开始测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
                <span class="token string">'/datashow/testflow/'</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>mark<span class="token punctuation">:</span> <span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">package</span><span class="token punctuation">:</span> package_name<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;测试结果:&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;&lt;hr&gt;&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;测试一共耗时:&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;秒&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;&lt;hr&gt;&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;总计流量消耗: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;byte&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;&lt;hr&gt;&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;上行流量: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token string">'up'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;byte&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;&lt;hr&gt;&quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;下行流量: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token string">'down'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#selection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                url<span class="token punctuation">:</span> <span class="token string">'/datashow/getdirlist/flowinfo'</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> arr <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> select <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;select id='selquery' class='form-control'&gt;&lt;/select&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        select <span class="token operator">=</span> select<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;option value='&quot;</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;'&gt;&quot;</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;/option&gt;&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#selection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>select<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>最终的效果图就是这样：</p> <p><img src="http://7xsgl3.com1.z0.glb.clouddn.com/02C218C4-5922-439C-A63B-10BC5661C5F4.png" alt="流量监控"></p> <h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>整个开发周期前后大概花了两周时间，这些知识熟的朋友应该可以更快，在使用前端知识的时候，我基本上都是靠w3cschool来解决，大概的概念我懂，但是具体的编码还是需要去copy。在整个项目写完后，我感觉我对这块的了解也更加深入了，重复造轮子的好处就是可以深入理解这些东西的来源，比如adb的使用，Android的一些知识。真正在工作当中使用的话，当然还是直接使用一些大公司的产品比较好，他们的东西比较成熟，精准度从一定程度上来说也比我们自己写的质量会高一些。</p> <p>最后的最后，代码放在<a href="https://github.com/diandianhanbin/AndroidTools" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，有兴趣的朋友可以自行翻阅。</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/16/2019, 11:21:44 PM</span></div></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-0cb1c278><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a81d141e data-v-a81d141e><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a81d141e><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a81d141e></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a81d141e></path></svg></div></div></div>
    <script src="/assets/js/app.9d685a6c.js" defer></script><script src="/assets/js/3.493be8e6.js" defer></script><script src="/assets/js/1.60dcf3bc.js" defer></script><script src="/assets/js/47.228181d7.js" defer></script>
  </body>
</html>
